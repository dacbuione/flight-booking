<div class="frequent-flyer-container">
  <div class="content-container" *ngIf="!isLoading; else loadingTemplate">
    <ng-container *ngIf="(frequentFlyer$ | async) as frequentFlyer; else notEnrolled">
      <!-- Header with member information -->
      <div class="member-header">
        <div class="tier-badge" [ngClass]="frequentFlyer.tierLevel.toLowerCase()">
          {{ getTierName(frequentFlyer.tierLevel) }}
        </div>
        <div class="member-info">
          <h2>ThÃ nh viÃªn: {{ frequentFlyer.membershipNumber }}</h2>
          <p>ÄÃ£ tham gia: {{ getFormattedDate(frequentFlyer.enrollmentDate) }}</p>
          <p>Háº¡n háº¡ng: {{ getFormattedDate(frequentFlyer.tierExpiryDate) }}</p>
        </div>
        <div class="points-display">
          <h3>{{ frequentFlyer.points | number }}</h3>
          <p>Ä‘iá»ƒm thÆ°á»Ÿng</p>
        </div>
      </div>

      <!-- Next tier progress -->
      <div class="tier-progress" *ngIf="nextTier">
        <h3>Tiáº¿n Ä‘á»™ lÃªn háº¡ng {{ getTierName(nextTier) }}</h3>
        <div class="progress-container">
          <div class="progress-bar" [style.width.%]="tierProgress"></div>
        </div>
        <p>CÃ²n {{ pointsToNextTier | number }} Ä‘iá»ƒm Ä‘á»ƒ lÃªn háº¡ng</p>
      </div>
      <div class="tier-progress" *ngIf="!nextTier">
        <h3>ChÃºc má»«ng! Báº¡n Ä‘Ã£ Ä‘áº¡t háº¡ng cao nháº¥t</h3>
        <div class="progress-container">
          <div class="progress-bar" [style.width.%]="100"></div>
        </div>
      </div>

      <!-- Benefits -->
      <div class="benefits-section">
        <h3>Æ¯u Ä‘Ã£i cá»§a báº¡n</h3>
        <div class="benefits-container">
          <div class="benefit-card" *ngFor="let benefit of (benefits$ | async)">
            <div class="icon">{{ benefit.icon }}</div>
            <h4>{{ benefit.name }}</h4>
            <p>{{ benefit.description }}</p>
          </div>
        </div>
      </div>

      <!-- Activity History -->
      <div class="activity-section">
        <h3>Lá»‹ch sá»­ hoáº¡t Ä‘á»™ng</h3>
        <div class="activity-table">
          <table>
            <thead>
              <tr>
                <th>NgÃ y</th>
                <th>Loáº¡i hoáº¡t Ä‘á»™ng</th>
                <th>MÃ´ táº£</th>
                <th>Äiá»ƒm</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let activity of (activityHistory$ | async)">
                <td>{{ getFormattedDate(activity.date) }}</td>
                <td>{{ activity.activityType }}</td>
                <td>{{ activity.description }}</td>
                <td [ngClass]="{'positive': activity.pointsEarned > 0, 'negative': activity.pointsEarned < 0}">
                  {{ activity.pointsEarned > 0 ? '+' : '' }}{{ activity.pointsEarned | number }}
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" *ngIf="totalActivities > pageSize">
          <button 
            [disabled]="currentPage === 1"
            (click)="changePage(currentPage - 1)"
          >
            &lt;
          </button>
          <span>{{ currentPage }}</span>
          <button 
            [disabled]="currentPage * pageSize >= totalActivities"
            (click)="changePage(currentPage + 1)"
          >
            &gt;
          </button>
        </div>
      </div>
    </ng-container>

    <!-- Not enrolled template -->
    <ng-template #notEnrolled>
      <div class="not-enrolled" *ngIf="!error">
        <h2>Trá»Ÿ thÃ nh ThÃ nh viÃªn ThÃ¢n thiáº¿t</h2>
        <p>Tham gia chÆ°Æ¡ng trÃ¬nh khÃ¡ch hÃ ng thÃ¢n thiáº¿t Ä‘á»ƒ tÃ­ch Ä‘iá»ƒm vÃ  nháº­n nhiá»u Æ°u Ä‘Ã£i Ä‘áº·c biá»‡t vá»›i má»—i chuyáº¿n bay</p>
        <div class="benefits-preview">
          <div class="benefit-card">
            <div class="icon">ğŸ«</div>
            <h4>TÃ­ch Ä‘iá»ƒm trÃªn má»—i chuyáº¿n bay</h4>
          </div>
          <div class="benefit-card">
            <div class="icon">ğŸ</div>
            <h4>Äá»•i Ä‘iá»ƒm láº¥y vÃ© miá»…n phÃ­</h4>
          </div>
          <div class="benefit-card">
            <div class="icon">â¬†ï¸</div>
            <h4>NÃ¢ng háº¡ng lÃªn thÆ°Æ¡ng gia</h4>
          </div>
          <div class="benefit-card">
            <div class="icon">ğŸ§³</div>
            <h4>HÃ nh lÃ½ Æ°u tiÃªn</h4>
          </div>
        </div>
        <button class="enroll-button" (click)="enrollInProgram()">ÄÄƒng kÃ½ ngay</button>
      </div>

      <div class="error-message" *ngIf="error">
        <div class="icon error-icon">âŒ</div>
        <p>{{ error }}</p>
      </div>
    </ng-template>
  </div>

  <!-- Loading template -->
  <ng-template #loadingTemplate>
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Äang táº£i thÃ´ng tin thÃ nh viÃªn...</p>
    </div>
  </ng-template>
</div> 