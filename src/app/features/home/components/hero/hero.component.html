<div class="hero-section">
  <!-- Background Video/Image Slider -->
  <div class="hero-background">
    <div class="swiper banner-swiper">
      <div class="swiper-wrapper">
        <div class="swiper-slide" *ngFor="let bg of backgrounds; let i = index">
          <div class="bg-overlay"></div>
          <img class="hero-img" [src]="bg" alt="Flight destinations" loading="lazy" />
        </div>
      </div>
      <div class="swiper-pagination dynamic-pagination"></div>
    </div>
  </div>

  <!-- Hero Content -->
  <div class="hero-content">
    <div class="container">
      <div class="hero-heading fade-in">
        <h1 class="text-gradient">Khám phá thế giới cùng chúng tôi</h1>
        <p class="subtitle">Hàng nghìn điểm đến, một hành trình tuyệt vời</p>
      </div>

      <!-- Search Card -->
      <div class="search-card glass-card slide-up">
        <!-- Search Tabs -->
        <div class="search-tabs">
          <button 
            class="tab-btn" 
            [class.active]="searchForm.get('tripType')?.value === 'roundtrip'"
            (click)="setTripType('roundtrip')"
          >
            <i class="bi bi-arrow-left-right"></i>
            <span>Khứ hồi</span>
          </button>
          <button 
            class="tab-btn" 
            [class.active]="searchForm.get('tripType')?.value === 'oneway'"
            (click)="setTripType('oneway')"
          >
            <i class="bi bi-arrow-right"></i>
            <span>Một chiều</span>
          </button>
          <button class="tab-btn" (click)="togglePromoCodeField()">
            <i class="bi bi-tag"></i>
            <span>Mã khuyến mãi</span>
          </button>
        </div>

        <!-- Search Form -->
        <form [formGroup]="searchForm" (ngSubmit)="searchFlights()">
          <!-- Promo Code Field (Conditional) -->
          <div class="promo-field" *ngIf="isPromoCodeVisible">
            <div class="form-floating">
              <input 
                type="text" 
                class="form-control" 
                id="promoCode" 
                formControlName="promoCode" 
                placeholder="Nhập mã giảm giá"
              >
              <label for="promoCode"><i class="bi bi-gift"></i> Mã giảm giá (nếu có)</label>
            </div>
          </div>

          <div class="search-form-row">
            <!-- From Location -->
            <div class="form-group location-group">
              <div class="form-control-wrapper" (click)="openLocationSelector('origin')">
                <div class="icon-wrapper origin-icon">
                  <i class="bi bi-airplane-takeoff"></i>
                </div>
                <div class="input-content">
                  <label>Điểm đi</label>
                  <div class="location-display">{{ getAirportDisplayName('origin') || 'Chọn điểm đi' }}</div>
                </div>
              </div>
            </div>

            <!-- Swap Button -->
            <button type="button" class="swap-btn" (click)="swapLocations()">
              <i class="bi bi-arrow-left-right"></i>
            </button>

            <!-- To Location -->
            <div class="form-group location-group">
              <div class="form-control-wrapper" (click)="openLocationSelector('destination')">
                <div class="icon-wrapper destination-icon">
                  <i class="bi bi-airplane-landing"></i>
                </div>
                <div class="input-content">
                  <label>Điểm đến</label>
                  <div class="location-display">{{ getAirportDisplayName('destination') || 'Chọn điểm đến' }}</div>
                </div>
              </div>
            </div>
          </div>

          <div class="search-form-row">
            <!-- Depart Date -->
            <div class="form-group date-group">
              <div class="form-control-wrapper" (click)="departPicker.open()">
                <div class="icon-wrapper">
                  <i class="bi bi-calendar-event"></i>
                </div>
                <div class="input-content">
                  <label>Ngày đi</label>
                  <div class="date-display">
                    <input 
                      type="text" 
                      class="date-input" 
                      [matDatepicker]="departPicker" 
                      formControlName="departDate" 
                      placeholder="DD/MM/YYYY" 
                      readonly
                      [min]="today"
                    />
                  </div>
                </div>
              </div>
              <mat-datepicker #departPicker></mat-datepicker>
            </div>

            <!-- Return Date -->
            <div class="form-group date-group" [class.disabled]="searchForm.get('tripType')?.value === 'oneway'">
              <div class="form-control-wrapper" (click)="searchForm.get('tripType')?.value === 'roundtrip' && returnPicker.open()">
                <div class="icon-wrapper">
                  <i class="bi bi-calendar-check"></i>
                </div>
                <div class="input-content">
                  <label>Ngày về</label>
                  <div class="date-display">
                    <input 
                      type="text" 
                      class="date-input" 
                      [matDatepicker]="returnPicker" 
                      formControlName="returnDate" 
                      placeholder="DD/MM/YYYY" 
                      readonly
                      [min]="getMinReturnDate()"
                    />
                  </div>
                </div>
              </div>
              <mat-datepicker #returnPicker></mat-datepicker>
            </div>
          </div>

          <div class="search-form-row passenger-row">
            <!-- Seat Class -->
            <div class="form-group dropdown-group">
              <div class="form-control-wrapper" (click)="toggleSeatClassDropdown()">
                <div class="icon-wrapper">
                  <i class="bi bi-person-square"></i>
                </div>
                <div class="input-content">
                  <label>Hạng ghế</label>
                  <div class="dropdown-display">
                    {{ getSeatClassDisplay() }}
                    <i class="bi bi-chevron-down"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- Passengers -->
            <div class="form-group dropdown-group">
              <div class="form-control-wrapper" (click)="togglePassengerDropdown($event)">
                <div class="icon-wrapper">
                  <i class="bi bi-people"></i>
                </div>
                <div class="input-content">
                  <label>Hành khách</label>
                  <div class="dropdown-display">
                    {{ getPassengerSummary() }}
                    <i class="bi bi-chevron-down"></i>
                  </div>
                </div>
              </div>
            </div>

            <!-- Search Button -->
            <div class="form-group search-btn-group">
              <button 
                type="submit" 
                class="search-btn" 
                [disabled]="!searchForm.valid"
              >
                <i class="bi bi-search"></i>
                <span>Tìm kiếm</span>
              </button>
            </div>
          </div>
        </form>

        <!-- Seat Class Dropdown -->
        <div class="dropdown-panel seat-class-panel glass-card" *ngIf="isSeatClassDropdownVisible" (click)="$event.stopPropagation()">
          <div class="dropdown-header">
            <h5>Hạng ghế</h5>
            <button type="button" class="close-btn" (click)="toggleSeatClassDropdown()">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="dropdown-content">
            <div 
              class="option-card" 
              *ngFor="let option of seatClassOptions"
              [class.active]="searchForm.get('seatClass')?.value === option.value"
              (click)="selectSeatClass(option.value)"
            >
              <div class="option-info">
                <h6>{{ option.label }}</h6>
                <p>{{ option.description }}</p>
              </div>
              <div class="option-check">
                <i *ngIf="searchForm.get('seatClass')?.value === option.value" class="bi bi-check-circle-fill"></i>
                <i *ngIf="searchForm.get('seatClass')?.value !== option.value" class="bi bi-circle"></i>
              </div>
            </div>
          </div>
          <div class="dropdown-footer">
            <button type="button" class="btn btn-primary" (click)="toggleSeatClassDropdown()">
              Áp dụng
            </button>
          </div>
        </div>

        <!-- Passenger Dropdown -->
        <div class="dropdown-panel passenger-panel glass-card" *ngIf="isPassengerDropdownVisible" (click)="$event.stopPropagation()">
          <div class="dropdown-header">
            <h5>Hành khách</h5>
            <button type="button" class="close-btn" (click)="togglePassengerDropdown($event)">
              <i class="bi bi-x-lg"></i>
            </button>
          </div>
          <div class="dropdown-content">
            <div class="passenger-options">
              <div class="passenger-item" *ngFor="let type of passengerTypes" [formGroupName]="type.key">
                <div class="passenger-info">
                  <h6>{{ type.label }}</h6>
                  <p>{{ type.ageDescription }}</p>
                </div>
                <div class="passenger-counter">
                  <button 
                    type="button" 
                    class="counter-btn minus" 
                    [disabled]="(searchForm.get(type.key)?.get('count')?.value === 0 && type.key !== 'adults') || (searchForm.get(type.key)?.get('count')?.value === 1 && type.key === 'adults')"
                    (click)="decreasePassenger(type.key)"
                  >
                    <i class="bi bi-dash"></i>
                  </button>
                  <span class="counter-value">{{ searchForm.get(type.key)?.get('count')?.value }}</span>
                  <button 
                    type="button" 
                    class="counter-btn plus" 
                    [disabled]="getTotalPassengers() >= 9 || searchForm.get(type.key)?.get('count')?.value >= type.max"
                    (click)="increasePassenger(type.key)"
                  >
                    <i class="bi bi-plus"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="dropdown-footer">
            <div class="passenger-summary">
              Tổng: <span>{{ getTotalPassengers() }} hành khách</span>
            </div>
            <button type="button" class="btn btn-primary" (click)="togglePassengerDropdown($event)">
              Áp dụng
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Location Selector Modal -->
<div class="modal-overlay" *ngIf="isLocationSelectorVisible" (click)="closeLocationSelector()">
  <div class="location-selector-modal" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2 class="modal-title">
        {{ currentLocationInput === 'origin' ? 'Chọn điểm đi' : 'Chọn điểm đến' }}
      </h2>
      <button class="close-button" (click)="closeLocationSelector()">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input
          type="text"
          placeholder="Tìm kiếm sân bay hoặc thành phố"
          [ngModel]="locationSearchQuery"
          (ngModelChange)="locationSearchQuery = $event; filterLocations()"
        />
      </div>
      <div class="location-tabs">
        <div
          class="tab"
          [class.active]="activeLocationTab === 'popular'"
          (click)="setLocationTab('popular')"
        >
          <i class="bi bi-star-fill me-2"></i> Phổ biến
        </div>
        <div
          class="tab"
          [class.active]="activeLocationTab === 'all'"
          (click)="setLocationTab('all')"
        >
          <i class="bi bi-grid-3x3-gap-fill me-2"></i> Tất cả
        </div>
      </div>
      <div class="location-list-container">
        <div class="location-list">
          <div
            class="location-item"
            *ngFor="let location of filteredLocations"
            (click)="selectLocation(location)"
          >
            <div class="location-icon">
              <i class="bi" [ngClass]="location.type === 'city' ? 'bi-buildings' : 'bi-airplane'"></i>
            </div>
            <div class="location-details">
              <div class="location-name">
                {{ location.name }}
              </div>
              <div class="location-info">
                {{ location.code }}
                <span *ngIf="isAirportLocation(location)"> - {{ location.cityName }}</span>
                {{ location.country }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
